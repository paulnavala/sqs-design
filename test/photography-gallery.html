<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Photography Gallery Test</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <!-- Local CSS Loader -->
    <script>
      (function () {
        'use strict';

        const BASE_URL = '..';
        const V = String(Date.now());
        const CSS_FILES = [
          '/components/portfolio-photo/portfolio-photo.css',
        ];

        function loadCSS(href) {
          const existing = document.querySelector(`link[href*="${href}"]`);
          if (existing) return;

          const link = document.createElement('link');
          link.rel = 'stylesheet';
          link.href = BASE_URL + href + '?v=' + V;
          document.head.appendChild(link);
        }

        CSS_FILES.forEach(function (file) {
          loadCSS(file);
        });
      })();
    </script>

    <!-- Local JS Loader -->
    <script>
      (function () {
        'use strict';

        const BASE_URL = '..';
        const V = String(Date.now());
        const JS_FILES = [
          '/components/portfolio-photo/portfolio-photo.js',
        ];

        function loadJS(src, callback) {
          const existing = document.querySelector(`script[src*="${src}"]`);
          if (existing) {
            if (callback) callback();
            return;
          }

          const script = document.createElement('script');
          script.src = BASE_URL + src + '?v=' + V;
          script.onerror = function () {
            console.warn('Failed to load:', src);
            if (callback) callback();
          };
          if (callback) {
            script.onload = callback;
          }
          document.head.appendChild(script);
        }

        let index = 0;
        function loadNext() {
          if (index >= JS_FILES.length) return;

          loadJS(JS_FILES[index], function () {
            index++;
            loadNext();
          });
        }

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', loadNext);
        } else {
          loadNext();
        }
      })();
    </script>

    <style>
      body {
        margin: 0;
        padding: 0;
        font-family:
          system-ui,
          -apple-system,
          'Segoe UI',
          Inter,
          Roboto,
          Arial,
          sans-serif;
        background: #f5f5f5;
      }
      .test-header {
        background: white;
        padding: 20px;
        border-bottom: 1px solid #ddd;
        margin-bottom: 40px;
      }
      .test-header h1 {
        margin: 0 0 10px;
        font-size: 24px;
      }
      .test-header p {
        margin: 0;
        color: #666;
        font-size: 14px;
      }
      .test-info {
        max-width: 1200px;
        margin: 0 auto 20px;
        padding: 0 20px;
      }
      .test-info code {
        background: #f0f0f0;
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 13px;
      }
    </style>
  </head>
  <body>
    <div class="test-header">
      <div class="test-info">
        <h1>Photography Gallery Test</h1>
        <p>
          Testing the photography gallery component with external JSON from
          <code>data/portfolio-photos.json</code>
        </p>
      </div>
    </div>

    <!-- Photography Gallery Component -->
    <div data-component="portfolio-photo" data-src="../data/portfolio-photos.json?v=dev" id="demo-portfolio-photo"></div>

    <!-- Local loader HTML injection -->
    <script>
      (function () {
        'use strict';
        function ready(fn) {
          if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', fn);
          else fn();
        }
        function injectLocal(targetSel, localPath, componentBase) {
          var target = document.querySelector(targetSel);
          if (!target) {
            console.error('Target not found:', targetSel);
            return;
          }
          fetch(localPath)
            .then((r) => r.text())
            .then((html) => {
              var clean = html.replace(/<!--[\s\S]*?-->/g, '').trim();
              target.innerHTML = clean;
              var evt = new CustomEvent('componentLoaded', {
                detail: { componentName: componentBase + '-loader.html', target: target, url: localPath },
              });
              try {
                target.dispatchEvent(evt);
              } catch (e) {}
              try {
                document.dispatchEvent(evt);
              } catch (e) {}
            })
            .catch((err) => {
              target.innerHTML = '<div style="color:red; padding:20px;">Failed to load loader HTML: ' + err.message + '</div>';
              console.error('Local loader load failed:', localPath, err);
            });
        }
        ready(function () {
          var v = String(Date.now());
          injectLocal('#demo-portfolio-photo', '../components/portfolio-photo/portfolio-photo-loader.html?v=' + v, 'portfolio-photo');
        });
      })();
    </script>
  </body>
</html>


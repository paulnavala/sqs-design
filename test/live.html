<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Live Test - Components (Auto-Reload)</title>

    <!-- Local CSS Loader (same as index-auto) -->
    <script>
      (function () {
        'use strict';

        const BASE_URL = '..';
        const CSS_FILES = [
    '/components/fortune-peach/fortune-peach.css',
    '/components/portfolio-uiux/portfolio-uiux.css',
    '/components/twin-gallery/twin-gallery.css',
    '/core/elegant-footer.css',
    '/core/header.css',
    '/core/portfolio.css',
    '/core/tw.css'
];

        function loadCSS(href) {
          const existing = document.querySelector(`link[href*="${href}"]`);
          if (existing) return;
          const link = document.createElement('link');
          link.rel = 'stylesheet';
          link.href = BASE_URL + href;
          document.head.appendChild(link);
        }
        CSS_FILES.forEach(loadCSS);
      })();
    </script>

    <!-- Local JS Loader (same as index-auto) -->
    <script>
      (function () {
        'use strict';

        const BASE_URL = '..';
        const JS_FILES = [
    '/core/utilities.js',
    '/core/component-loader.js',
    '/core/elegant-footer.js',
    '/components/fortune-peach/fortune-peach.js',
    '/components/mobile-menu/mobile-menu.js',
    '/components/portfolio-uiux/portfolio.js',
    '/components/project-card/project-card.js',
    '/components/prototype-showcase/prototype-showcase.js',
    '/components/tagline/tagline.js',
    '/components/twin-gallery/twin-gallery.js'
];

        function loadJS(src, callback) {
          const existing = document.querySelector(`script[src*="${src}"]`);
          if (existing) { if (callback) callback(); return; }
          const script = document.createElement('script');
          script.src = BASE_URL + src;
          script.onerror = function () { console.warn('Failed to load:', src); if (callback) callback(); };
          if (callback) script.onload = callback;
          document.head.appendChild(script);
        }

        let index = 0;
        function loadNext() {
          if (index >= JS_FILES.length) return;
          loadJS(JS_FILES[index], function () { index++; loadNext(); });
        }
        if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', loadNext); else loadNext();
      })();
    </script>

    <style>
      body { margin: 0; padding: 40px 20px; font-family: system-ui, -apple-system, 'Segoe UI', Inter, Roboto, Arial, sans-serif; background: #f5f5f5; }
      .test-container { max-width: 1200px; margin: 0 auto; }
      .component-section { background: white; border-radius: 8px; padding: 40px; margin-bottom: 60px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
      .component-title { font-size: 24px; font-weight: 600; margin-bottom: 20px; color: #333; border-bottom: 2px solid #eee; padding-bottom: 10px; }
      .component-info { font-size: 14px; color: #666; margin-bottom: 30px; padding: 12px; background: #f9f9f9; border-radius: 4px; }
      .live-indicator { position: fixed; right: 12px; bottom: 12px; background: #111; color: #fff; padding: 8px 12px; border-radius: 999px; font-size: 12px; opacity: 0.8; }
      .live-indicator span { display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: #2ecc71; margin-right: 8px; vertical-align: middle; }
      .live-indicator.is-disconnected span { background: #e74c3c; }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1 style="text-align:center; margin-bottom: 40px">Live Test Page</h1>
      <p class="component-info">Keep this tab open. Changes to files will trigger an automatic reload. Editing <code>data/portfolio-projects.json</code> will rebuild the portfolio data before reload.</p>
      <div class="component-section">
        <h2 class="component-title">Components (from registry)</h2>
        <div id="components-root" class="test-components"></div>
      </div>

      <div class="component-section">
        <h2 class="component-title">Mobile Menu (Vue)</h2>
        <div class="component-info">Mounts overlay and hooks your theme's mobile menu toggle.</div>
        <div class="component-content">
          <div data-component="mobile-menu"></div>
        </div>
      </div>

      <div class="component-section">
        <h2 class="component-title">Tagline (Vue)</h2>
        <div class="component-info">Typewriter effect with caret and glow.</div>
        <div class="component-content">
          <div data-component="tagline"></div>
        </div>
      </div>

      <div class="component-section">
        <h2 class="component-title">Prototype Showcase (Vue)</h2>
        <div class="component-info">Figma embed with reveal, spinner and fallback.</div>
        <div class="component-content">
          <div data-component="prototype-showcase" data-title="CERN Prototype" data-figma="https://www.figma.com/proto/OUowEnozqwEO4wIcu5qcxh/CERN?node-id=1-105&page-id=0%3A1&starting-point-node-id=1%3A105&scaling=scale-down-width&show-proto-sidebar=0"></div>
        </div>
      </div>

      <div class="component-section">
        <h2 class="component-title">Project Card (Vue)</h2>
        <div class="component-info">Parallax hover effect on elements with class <code>.project-card</code>.</div>
        <div class="component-content">
          <div data-component="project-card"></div>
          <div style="display:grid;gap:16px;margin-top:12px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))">
            <div class="project-card" style="height:140px;border-radius:12px;background:radial-gradient(circle at calc(50% + var(--bg-x,0px)) calc(50% + var(--bg-y,0px)), #ddd, #bbb);"></div>
            <div class="project-card" style="height:140px;border-radius:12px;background:radial-gradient(circle at calc(50% + var(--bg-x,0px)) calc(50% + var(--bg-y,0px)), #ddd, #bbb);"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Load all components from registry into the page -->
    <script src="components.js"></script>

    <!-- Live reload client (SSE) -->
    <script>
      (function () {
        'use strict';
        var badge = document.createElement('div');
        badge.className = 'live-indicator';
        badge.innerHTML = '<span></span> Live Reload Connected';
        document.body.appendChild(badge);

        function connect() {
          var es = new EventSource('/__livereload');
          es.onopen = function () { badge.classList.remove('is-disconnected'); };
          es.onerror = function () { badge.classList.add('is-disconnected'); };
          es.onmessage = function (e) {
            if (e.data === 'reload') {
              // Avoid reloading while the document is still loading
              if (document.visibilityState === 'hidden') { location.reload(); return; }
              location.reload();
            }
          };
        }
        if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', connect); else connect();
      })();
    </script>
  </body>
  </html>


